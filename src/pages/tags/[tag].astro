---
import type { GetStaticPaths } from 'astro'

import ArticleArchiveLayout from '@/layouts/ArticleArchiveLayout.astro'
import { getTags, groupArticlesByYear } from '@/utils/articles'

export const getStaticPaths = (async () => {
	const tags = await getTags()
	return [...tags.keys()].map((tag) => ({
		params: { tag },
		props: { tags },
	}))
}) satisfies GetStaticPaths

const { tags } = Astro.props
const { tag } = Astro.params

// タグの存在チェックとデータ取得
const tagData = tags.get(tag)
if (!tagData) {
	throw new Error(`Tag "${tag}" not found`)
}

const { articles, name: tagName } = tagData
const archiveMap = groupArticlesByYear(articles)
---

<ArticleArchiveLayout
	archiveMap={archiveMap}
	title={tagName}
	subTitle='タグの記事一覧'
/>
