---
import type { GetStaticPaths } from 'astro'

import ArticleArchiveLayout from '@/layouts/ArticleArchiveLayout.astro'
import { getCategories, groupArticlesByYear } from '@/utils/articles'

export const getStaticPaths = (async () => {
	const categories = await getCategories()
	return [...categories.keys()].map((category) => ({
		params: { category: category },
		props: { categories },
	}))
}) satisfies GetStaticPaths

const { categories } = Astro.props
const { category } = Astro.params

// カテゴリの存在チェックとデータ取得
const categoryData = categories.get(category)
if (!categoryData) {
	throw new Error(`Category "${category}" not found`)
}

const { articles, name: categoryName } = categoryData
const archiveMap = groupArticlesByYear(articles)
---

<ArticleArchiveLayout archiveMap={archiveMap} title={categoryName} subTitle='カテゴリーの記事一覧' />
